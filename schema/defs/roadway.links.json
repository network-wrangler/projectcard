{
  "$schema": "http://json-schema.org/draft-07/schema",
  "id": "roadway.links",
  "description": "Requirements for roadway links.",
  "type":"object",
  "definitions":{
    "node":{
      "id": "roadway.links.node",
      "type": "integer",
      "description": "Foreign key to the nodes object."
    },
    "intersectionId":{
      "id": "roadway.links.intersectionId",
      "type": "string",
      "description": "The Intersectionid Schema",
      "examples": ["4d0231aa0ebb779f142c2518703ee481"]
    },
    "shstReferenceId": {
      "$id": "roadway.links.shstReferenceId",
      "type": "string",
      "description": "The Shstreferenceid Schema",
      "examples": [ "6a22969708104ae2497244f3d079381d"]
    },
    "shstGeometryId": {
      "$id": "roadway.links.shstGeometryId",
      "type": "string",
      "description": "The Shstgeometryid Schema",
      "examples": [ "6a22969708104ae2497244f3d079381d"]
    },
    "bearing": {
      "id": "roadway.links.bearing",
      "type": "integer",
      "minimum": 0,
      "maximum":360,
      "description": "The angle of the eminating arc from the point, expressed in clockwise degrees from North (0)",
      "examples": [0, 90, 275]
    },
    "point": {
      "id": "roadway.links.point",
      "#ref": "roadway.nodes.json#/definitions/roadway.nodes.point"
    },
    "distance": {
      "id": "roadway.links.distance",
      "type": "number",
      "title": "Distance",
      "minimum": 0,
      "examples": [93.08]
    },
    "name":{
      "id": "roadway.links.name",
      "type": "string",
      "examples": ["Elm Street","Raleigh Beltline", "Capital Beltway","3rd St,Willie Mays Blvd"],
      "description":"Name of Roadway facility. If multiple, can be contatenated with a comma."
    },
    "ref":{
      "id": "roadway.links.ref",
      "type": "string",
      "examples": ["I-40","US66","WA520"],
      "description":"Reference name of roadway, per Open Street Map definition."
    },
    "model_link_id":{
      "id": "roadway.links.model_link_id",
      "type": "integer",
      "description": "Unique id for facility."
    },
    "osm_link_id":{
      "id": "roadway.links.osm_link_id",
      "type": "string",
      "description":"Reference to the corresponding Open Street Map link. Note that due to link splitting this may or may not be unique, and is not a required attribute."
    },
    "roadway":{
      "id": "roadway.links.roadway",
      "type": "string",
      "enum":["motorway","trunk","primary","secondary","tertiary","unclassified","residential","motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","living_street","service","pedestrian","footway","steps","cycleway","track","bus_guideway","road"],
      "default":"road",
      "description":"Roadway type, using [OSM Highway values](https://wiki.openstreetmap.org/wiki/Key:highway#Roads). Notes: * `X_link` roadway types denote linkage roads going to/from roadway type X (i.e. on/off ramps, etc). * `road` denotes unknown type."
    },
    "locationReferences": {
      "id": "roadway.links.locationReferences",
      "type": "array",
      "description": "The Locationreferences Schema",
      "items": {
        "type": "object",
        "required": [
          "sequence",
          "point"
        ],
        "properties": {
          "sequence": {"type": "integer","minimum":0},
          "point": {"$ref":"#/definitions/point"},
          "distanceToNextRef": {"$ref":"#/definitions/distance"},
          "bearing":  {"$ref":"#/definitions/bearing"},
          "intersectionId":  {"$ref":"#/definitions/intersectionId"}
        }
      }
    },
    "lanes":{
      "id": "roadway.links.lanes",
      "oneOf": [
        {"type": "number","minimum":0},
        {"$ref": "#/definitions/property.by_time-of-day"},
        {"$ref": "#/definitions/property.by_access-category"},
        {"$ref": "#/definitions/property.by_access-category-and-time-of-day"}
      ],
      "examples": [2,5,{"default":1,"timeofday":{"time":["6:00","9:00"],"value":2}}],
      "description": "Number of lanes either in simple or complex terms."
    },
    "ML_lanes":{
      "id": "roadway.links.ML_Lanes",
      "$ref": "#/definitions/lanes",
      "description": "Lanes for a parallel managed lane facility."
    },
    "property.by_time-of-day":{
      "id": "roadway.links.property.by_time-of-day",
      "type": "object",
      "examples": [
        {"default":1,"timeofday":[{"time":["7:00","9:00"],"value":0.50}]}
      ],
      "required": ["default","timeofday"],
      "properties":{
        "default": {"type": "number","minimum":0},
        "timeofday": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["time","value"],
            "properties": {
              "time": {"$ref": "timespan.json"},
              "value": {"type": "number","minimum":0}
            }
          }
        }
      }
    },
    "property.by_access-category":{
      "id": "roadway.links.property.by_access-category",
      "type": "object",
      "required": ["default","groups"],
      "examples": [
        {"default":1,"groups":[{"category":["HOV2"],"value":0.50}]}
      ],
      "properties":{
        "default": {"type": "number","minimum":0},
        "group": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["category","value"],
            "properties": {
              "category": {"type": "array","items":{"type":"string"}},
              "value": {"type": "number","minimum":0}
            }
          }
        }
      }
    },
    "property.by_access-category-and-time-of-day":{
      "id": "roadway.links.property.by_access-category-and-time-of-day",
      "type": "object",
      "required": ["default","timeofday"],
      "examples": [
        {"default":1,"timeofday":[{"time":["7:00","9:00"],"category":["HOV2"],"value":0.50}]}
      ],
      "properties":{
        "default": {"type": "number","minimum":0},
        "timeofday": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["category","time","value"],
            "properties": {
              "category": {"type": "array","items":{"type":"string"}},
              "time": {"$ref": "timespan.json"},
              "value": {"type": "number","minimum":0}
            }
          }
        }
      }
    },
    "price":{
      "id": "roadway.links.price",
      "oneOf": [
        {"type": "number","minimum":0},
        {"$ref": "#/definitions/property.by_time-of-day"},
        {"$ref": "#/definitions/property.by_access-category"},
        {"$ref": "#/definitions/property.by_access-category-and-time-of-day"}
      ],
      "examples": [0.75,2.90,{"default":1,"timeofday":{"time":["6:00","9:00"],"value":2}}],
      "description": "Price of facility, either as a positive number of a complex type by time of day and/or access category."
    },
    "ML_price":{
      "id": "roadway.links.ML_price",
      "$ref": "#/definitions/price",
      "description": "Price for a parallel managed lane facility."
    },
    "walk_access":{
      "id": "roadway.links.walk_access",
      "type":["integer","boolean"] ,
      "description": "Indicates if a facility is generally available for pedestrians. Must not be true if any of bus_only or rail_only are true."
    },
    "bike_access":{
      "id": "roadway.links.bike_access",
      "type":["integer","boolean"] ,
      "description": "Indicates if a facility is generally available for cyclists. Must not be true if any of bus_only or rail_only are true."
    },
    "bike_facility":{
      "id": "roadway.links.bike_facility",
      "type":"integer",
      "minimum": 0,
      "description": "Indicator for the category of bicycle facility on or along the roadway. If null, indicates unknown. If zero, indicates no facility."
    },
    "drive_access":{
      "id": "roadway.links.drive_access",
      "type":["integer","boolean"],
      "description": "Indicates if a facility is generally available for driving. Must not be true if any of bus_only or rail_only are true."
    },
    "bus_only":{
      "id": "roadway.links.bus_only",
      "type":["integer","boolean"],
      "description": "Indicates if a facility is rail-only if True.  Must not be true if any of walk_access, bike_access, drive_access, rail_only are True."
    },
    "rail_only":{
      "id": "roadway.links.rail_only",
      "type":["integer","boolean"],
      "description": "Indicates if a facility is rail-only if True.  Must not be true if any of walk_access, bike_access, drive_access, bus_only are True."
    },
    "segment_id":{
      "id": "roadway.links.segment_id",
      "type": ["string","integer"],
      "description": "An identifier for segments of roadway. Can be useful for querying and setting values for parts of facilities, summary scripts, etc."
    },
    "ML_access":{
      "id": "roadway.links.ML_access",
      "oneOf": [
        {"type":"string","value":"all"},
        {"type":"array","items":{"$ref": "#/definitions/node"},"minItems":1}
      ],
      "examples":["all",[123,5543]],
      "description": "Indicates where a managed lane facility can by accessed either by indicating `all` for everywhere, or listing foreign keys to specific A-nodes."
    },
    "ML_egress":{
      "id": "roadway.links.ML_egress",
      "$ref": "#/definitions/ML_access",
      "description": "Indicates where a managed lane facility can by existed either by indicating `all` for everywhere, or listing foreign keys to specific B-nodes."
    }
  },
  "title": "Roadway links",
  "required": [
    "A",
    "B",
    "name",
    "model_link_id",
    "roadway",
    "lanes",
    "walk_access",
    "drive_access",
    "bus_only",
    "rail_only"
  ],
  "properties": {
    "A":{"$ref": "#/definitions/node"},
    "B":{"$ref": "#/definitions/node"},
    "model_link_id":{"$ref": "#/definitions/model_link_id"},
    "osm_link_id":{"$ref": "#/definitions/osm_link_id"},
    "shstReferenceId":{"$ref": "#/definitions/shstReferenceId"},
    "shstGeometryId":{"$ref": "#/definitions/shstGeometryId"},
    "locationReferences":{"$ref": "#/definitions/locationReferences"},
    "name":{"$ref": "#/definitions/name"},
    "ref":{"$ref": "#/definitions/ref"},
    "roadway":{"$ref": "#/definitions/roadway"},
    "lanes":{"$ref": "#/definitions/lanes"},
    "price":{"$ref": "#/definitions/price"},
    "ML_lanes":{"$ref": "#/definitions/lanes"},
    "ML_price":{"$ref": "#/definitions/ML_price"},
    "ML_access":{"$ref": "#/definitions/ML_access"},
    "ML_egress":{"$ref": "#/definitions/ML_egress"},
    "walk_access":{"$ref": "#/definitions/walk_access"},
    "bike_access":{"$ref": "#/definitions/bike_access"},
    "bike_facility":{"$ref": "#/definitions/bike_facility"},
    "drive_access":{"$ref": "#/definitions/drive_access"},
    "bus_only":{"$ref": "#/definitions/bus_only"},
    "rail_only":{"$ref": "#/definitions/rail_only"},
    "segment_id":{"$ref": "#/definitions/segment_id"}
  }
}
